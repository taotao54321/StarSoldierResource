+++
title = "BGM"
date = 2021-06-14
+++

## BGM ID {#id}

| ID | BGM                         |
| -- | --                          |
| 0  | (BGM なし)                  |
| 1  | タイトル画面                |
| 2  | ラザロ戦                    |
| 3  | スターブレイン撃破          |
| 4  | ゲーム終了                  |
| 5  | 面イントロ (フルパワー未満) |
| 6  | 面ループ (フルパワー未満)   |
| 7  | スターブレイン戦            |
| 8  | 面ループ (フルパワー)       |
| 9  | 面イントロ (フルパワー)     |
| 10 | 無音                        |

## BGM データ

各BGM は矩形波1, 矩形波2, 三角波の 3 つのトラックから成る。  
また、BGM ごとに矩形波の音色(`$4000`, `$4004` へ書き込む値)が設定されている。

### 矩形波の音色

`$B716` に無音を除く各BGMの矩形波の音色がある。  
全てエンベロープを使用している。

### トラックデータ {#track-data}

`$BBA6` に各BGMに対応するトラックデータへのポインタ(矩形波1, 矩形波2, 三角波)がある。

トラックデータは以下のコマンドの羅列:

| `cmd`         | 内容                                                                       |
| --            | --                                                                         |
| `0`           | 現在の音長だけ消音                                                         |
| `25..=0x7F`   | `cmd-1` を 12 で割った商をオクターブ、余りをノートとして現在の音長だけ発音 |
| `0x80..=0xEF` | 音長を `cmd&0x7F` に設定(フレーム単位)                                     |
| `0xFC`        | ループ末尾                                                                 |
| `0xFD` `<n>`  | n 回のループを開始 (1重ループのみサポート)                                 |
| `0xFE`        | BGM先頭に戻る                                                              |
| `0xFF`        | BGM終了                                                                    |

無限ループするBGMは矩形波1トラックのみ `0xFE` で終端されており、他のトラックは終端コマンドがない。

三角波の場合、発音コマンドは1オクターブ低い音になる。また、現在の音長の 3/4 だけ発音し、残り 1/4 は消音する。
