+++
title = "敵編隊"
date = 2021-06-12
+++

敵はオブジェクトIDごとに編隊に関するパラメータを持っている。

固定パラメータは以下の通り:

| 項目                                 | 概要                                                                   |
| --                                   | --                                                                     |
| [ボス属性](#group-boss)              | 被弾時の挙動に影響する。道中の敵ではジェリコ、ラザロのみ真。           |
| 難易度                               | 現在の面がこの値以上のとき、ランク上昇や挙動の変化が起こる。           |
| [弾抑制フラグ](#group-noshot)        | 特定条件下で自機狙い弾を撃たない。                                     |
| [弾高速化フラグ](#group-accel-shot)  | 特定条件下で自機狙い弾が高速化する。                                   |
| [誘導弾化フラグ](#group-homing-shot) | 特定条件下で自機狙い弾が必ず誘導弾になる。                             |
| [再行動フラグ](#group-extra-act)     | 特定条件下で移動後に再行動する。                                       |
| [高速化フラグ](#group-accel)         | 特定条件下で高速化する。                                               |
| 基本メタスプライトID                 | 仮想マシンの `set_sprite` 命令はこの値に対する相対値として解釈される。 |
| 初期座標                             |                                                                        |
| 出現間隔                             | 敵1体が出現するまでの待ちフレーム数。                                  |
| 出現数                               |                                                                        |
| バイトコード                         | [敵AI](@/enemy-ai/index.md)を参照。                                    |
| エントリポイント                     | バイトコードの実行開始アドレス。敵1体ごとに設定されている。            |

可変パラメータは以下の通り:

| 項目                  | 概要                                                             |
| --                    | --                                                               |
| [ランク](#group-rank) | 値に応じて敵の挙動が変化する。初期値は 0 で、最大 7 まで上がる。 |

## ボス属性 {#group-boss}

敵が被弾したとき、

* 敵がボス属性を持つ場合、HP 0 なら死亡し、さもなくば HP が 1 減る。
* 敵がボス属性を持たない場合、仮想マシンの被弾時ジャンプ先が設定されていればそこへジャンプし、さもなくば死亡する。

## 弾抑制フラグ {#group-noshot}

弾抑制フラグを持つ敵は、ランク 3 以下では自機狙い弾を撃たない。

## 弾高速化フラグ {#group-accel-shot}

敵が弾高速化フラグを持つ場合、発射する自機狙い弾のスピードが `8*(ランク)/16` となる(切り捨て除算)。  
これ以外の場合、自機狙い弾はスピード 0 である。

## 誘導弾化フラグ {#group-homing-shot}

敵が誘導弾化フラグを持ち、かつ2周目でランク 7 以上ならば、発射する自機狙い弾が必ず誘導弾になる。

## 再行動フラグ {#group-extra-act}

敵が再行動フラグを持ち、かつ `(現在の面) >= (難易度) && (ランク) >= 4` ならば、移動後に仮想マシンを追加で 1 ステップ実行する(再行動に対する再行動は行わない)。

## 高速化フラグ {#group-accel}

敵が高速化フラグを持ち、かつ `(現在の面) >= (難易度)` ならば、敵のスピード 1 以下の移動が高速化する:

* ランク 4 以上 6 以下ならばスピード +1
* ランク 7 以上ならばスピード +2

## ランク {#group-rank}

`(現在の面) >= (難易度)` のとき、敵編隊が出現するたびに対応する敵オブジェクトのランクが 1 上がる。  
2周目の場合は条件が変化し、`(現在の面)+2 >= (難易度)` となる。
